<div class="mt-3">
  <a
    class="p-button no-underline"
    [routerLink]="['/'+Routing.ADMIN+'/'+Routing.ADMIN_DASHBOARD]"
    ><i class="pi pi-arrow-left mr-2"></i>Retour</a
  >
</div>
<div class="mt-5">
  <h2 class="text-center text-blue-500 text-2xl">Gestion des munitions</h2>

  <p-tabView>
    <p-tabPanel header="{{totalAmmunition()}} Munitions enregistrées">
      @if (!newAmmunitionForm){
      <div class="w-3">
        <app-caliber-dropdown
          [initDropdown]="currentCaliberId()"
          (selectedCaliber)="filterByCaliber($event.id)"></app-caliber-dropdown>
      </div>
      <p-table
        [value]="filteredAmmunition"
        [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Id</th>
            <th>Calibre</th>
            <th>Marque</th>
            <th>Model</th>
            <th>Vitesse initiale</th>
            <th>Poids</th>
            <th>Status</th>
            <th>Ajouté le</th>
            <th class="text-center">Modifier</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-ammo>
          <tr>
            <td>{{ ammo.id }}</td>
            <td>{{ ammo.caliber.label }}</td>
            <td>{{ ammo.factory.name }}</td>
            <td>{{ ammo.name }}</td>
            <td>{{ ammo.initialSpeed}} m/s</td>
            <td>{{ ammo.weight.grains }} grains</td>
            <td>
              <div class="flex align-items-center">
                {{ammo.active? 'Active' : 'Désactivée' }}
                <p-button
                  icon="pi pi-ban"
                  severity="danger"
                  [text]="true"
                  (onClick)="confirm($event,ammo)"></p-button>
              </div>
            </td>
            <td>{{ ammo.createdAt | date:'dd MMM yyyy' }}</td>
            <td class="text-center">
              <p-button
                label="Editer"
                (onClick)="edit(ammo)"
                icon="pi pi-user-edit"
                [text]="true"></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
      }

      <div class="mt-2 text-center">
        <p-button
          label="Ajouter"
          icon="pi pi-plus"
          (onClick)="addAmmunition()"></p-button>
        @defer (when newAmmunitionForm){ @if (newAmmunitionForm){
        <app-ammunition-form
          (newAmmunitionAdded)="newAmmunition($event)"
          [ammunitionForm]="ammunitionToEdit()"
          (ammunitionEdited)="ammunitionEdited($event)"></app-ammunition-form>
        } }
      </div>
    </p-tabPanel>
    <p-tabPanel header=" Marques disponibles">
      <ng-template pTemplate="content">
        <app-factory-table-list
          [factoryType]="FactoryType.AMMUNITION"></app-factory-table-list>
      </ng-template>
    </p-tabPanel>
    <p-tabPanel header="Calibres">
      <ng-template pTemplate="content">
        <app-caliber-table-list></app-caliber-table-list>
      </ng-template>
    </p-tabPanel>
    <p-tabPanel header="Poids des munitions">
      <ng-template pTemplate="content">
        <app-ammunition-weight-list></app-ammunition-weight-list>
      </ng-template>
    </p-tabPanel>
  </p-tabView>
</div>
